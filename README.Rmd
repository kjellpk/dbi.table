---
title: "dbi.table"
output: md_document
---

# `dbi.table`

Query database objects (e.g., tables and views) accessible over a `DBI`
connection using `data.table`-like syntax. Access individual objects using
`dbi.table` or attach an entire schema using `dbi.attach`.


## Installation

```{r, eval = FALSE}
devtools::install_github("kjellpk/dbi.table")
```

## Usage

First, load the package.

```{r, library, message = FALSE}
library(dbi.table)
```

Then open up a `DBIConnection` to the [CTU Prague Relational Learning
Repository](https://relational-data.org/).

```{r, connection}
rdp_conn <- DBI::dbConnect(RMariaDB::MariaDB(),
                           host = "relational.fel.cvut.cz",
                           port = 3306,
                           user = "guest",
                           password = "ctu-relational")
```

Make an `Id` for the `Album` table in the `Chinook` schema.

```{r, id}
album_table_id <- DBI::Id(table_schema = "Chinook", table_name = "Album")
```

Finally, create the `dbi.table`.

```{r, dbi.table}
(Album <- dbi.table(rdp_conn, album_table_id))
```

The `print` method fetches the first 5 records from the database and displays
them as a `data.table` (with the row numbers omitted). The underlying SQL query
can be viewed using the `csql` function.

```{r csql}
csql(Album)
```

The `dbi.table` can be manipulated using `data.table` syntax.

```{r syntax}
(x <- Album[nchar(Title) > 20 & AlbumId > ArtistId,
            .(Title, Title_Length = paste(nchar(Title), "characters"))])
```

Again, the underlying SQL query can be viewed with `csql`.

```{r csqlx}
csql(x)
```

```{r cleanup, echo = FALSE, results = "hide"}
DBI::dbDisconnect(rdp_conn)
```
